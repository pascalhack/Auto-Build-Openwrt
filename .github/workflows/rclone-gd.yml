name: Rclone-GD
on:
  workflow_dispatch:
  repository_dispatch:
  schedule:
    - cron: 0 21 * * 5
      
env:
    rc_rclone: ${{ secrets.RCONFIG }}
 
jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@master
    #  - name: Initialization environment
     #   run: |
      #   sudo rm -rf /etc/apt/sources.list.d/* /usr/share/dotnet /usr/local/lib/android /opt/ghc
       #  sudo -E apt-get -qq update
       #  sudo -E apt-get -qq install $(curl -fsSL git.io/depends-ubuntu-1804)
       #  sudo -E apt-get -qq autoremove --purge
       #  sudo -E apt-get -qq clean
      - name: Configure rclone environment   
        run: | 
         curl https://rclone.org/install.sh | sudo bash  
      - name: Configure rclone Config File 
        run: | 
         sudo mkdir -p /home/runner/.config/rclone
            
         sudo cat > rclone.conf << EOF
          ${rc_rclone}
          
         EOF
         sudo mkdir -p /mnt/gdrive
         sudo cp rclone.conf /home/runner/.config/rclone/  
         sudo rm -rf /home/runner/work/openwrt-CI/openwrt-CI/rclone.conf
         sudo rclone mount GD: /mnt/gdrive --copy-links --allow-other --allow-non-empty --umask 000 --daemon &

      - name: Copy File
        run: |
         sudo tar czvf x64-bin.`date +%Y%m%d`.tar.gz *  
         tmp=$(find . -name "*.tar.gz")
         echo $tmp
         sudo rclone sync $tmp GD:bin 
        #  sudo rclone sync diy.sh GD:dl
       #  sudo rclone copy GD:dl/openwrtx64.tar.gz /home/runner/work/openwrt-CI/openwrt-CI
          
      #- name: Start SSH via tmate
       # uses: P3TERX/ssh2actions@main
       # env:
       #  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
         #TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
